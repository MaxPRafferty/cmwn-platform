#!/usr/bin/env bash

docker-machine active
if [ $? != 0 ]
then
    echo "[post-merge] no default docker-machine running"
    echo "[post-merge] you should check for updates in composer.json yourself"
    exit 1
fi

echo "[post-merge] Checking for new modules"

if [ "composer.json" -nt "vendor/" ]; then
    echo "[post-merge] New composer.json installing new packages"
    docker-compose run php composer update --ignore-platform-reqs
fi

docker-compose run php phinx migrate -c config/phinx.php -e dev
docker-compose run php phinx seed:run -c config/phinx.php -e dev
